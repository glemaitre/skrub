name: Unit Tests

on:
  push:
    branches:
    - main
  pull_request:
    branches:
      - main

jobs:
  check_skip:
    runs-on: ubuntu-latest
    outputs:
      skip: ${{ steps.result_step.outputs.ci-skip }}
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - id: result_step
        uses: mstachniuk/ci-skip@master
        with:
          commit-filter: '[skip ci];[ci skip];[skip github]'
          commit-filter-separator: ';'

  build:
    needs: check_skip
    strategy:
      matrix:
        os: [windows-latest, ubuntu-latest, macos-latest, macos-12]
        environment: [
            ci-py310-min-deps, ci-py311-min-deps,
            ci-py310-latest-deps, ci-py311-latest-deps, ci-py312-latest-deps,
            ci-py312-latest-optional-deps
        ]
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v4
      - uses: prefix-dev/setup-pixi@v0.8.1
        with:
          pixi-version: v0.23.0
          environments: ${{ matrix.environment }}
          # we can freeze the environment and manually bump the dependencies to the
          # latest version time to time.
          frozen: true

      - name: Run tests
        run: pixi run -e ${{ matrix.environment }} test

      # - name: Upload coverage reports to Codecov
      #   uses: codecov/codecov-action@v4.4.1
      #   with:
      #     token: ${{ secrets.CODECOV_TOKEN }}
      #     slug: scikit-learn-contrib/project-template
